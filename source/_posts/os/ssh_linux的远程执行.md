---
title: CentOS学习
categories: os
tags: [远程执行,linux]
---

references

完整的server/client配置实践[git服务部署](./git服务部署.md)

**相关命令**

###ssh  

用法[http://blog.csdn.net/pipisorry/article/details/52269785](http://blog.csdn.net/pipisorry/article/details/52269785)

`ssh -V` 查看ssh版本 

* 默认端口: 22

ssh-keygen

-

### 公钥、私钥

**资料**

数据公钥加密和认证中的私钥公钥[http://www.williamlong.info/archives/837.html](http://www.williamlong.info/archives/837.html)  
使用ssh-keygen设置SSH无密码登录[http://blog.csdn.net/leexide/article/details/17252369](http://blog.csdn.net/leexide/article/details/17252369)  
Linux ssh服务开启秘钥和密码认证[https://www.cnblogs.com/xiaochina/p/6867298.html](https://www.cnblogs.com/xiaochina/p/6867298.html)

**公钥,私钥是怎么实现不对称加密的?**

1. 私钥是绝对保密的,私钥用来进行解密和签名, 是给自己用的
2. 公钥由本人公开，用于加密和验证签名，是给别人用的。
3. 当该用户发送文件时，用私钥签名，别人用他给的公钥验证签名，可以保证该信息是由他发送的。当该用户接受文件时，别人用他的公钥加密，他用私钥解密，可以保证该信息只能由他接收到。

**安全性**

目前能破解的RSA算法密钥是768个二进制位. 超过此长度的破解无人公开公布过。一般认为1024的密钥基本安全, 2048位的密码极其安全。

**生成公钥,私钥**

ssh-keygen

+ -t *type* 

	指定要创建的密钥类型。可以使用："rsa1"(SSH-1) "rsa"(SSH-2) "dsa"(SSH-2)

+ -p

	要求改变某私钥文件的密语而不重建私钥。程序将提示输入私钥文件名、原来的密语、以及两次输入新密语。
	
`ssh-keygen -t rsa` 生成本机的公私钥



**.ssh目录及文件**

1. known_hosts文件

	记录访问过的主机的公钥

	```
	192.168.237.72 ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAppBeLNHwpSlWGtLMeW0SpJ0TQs8qyHWxyBxh1JM8b9mJgvsRj8/xUDjcDgC59xXQkeX37Hp4DtlWz4bwkR4im5WLQ3QVj0YSw/1WrB/x/TNhHWvFMP8IXi18ZfTuCtBTufZZzt0ZPFkbioKVf4hg3ukEXIhxYlRaByhb/2U22rBdImGAkq6tV7ZPvemfcTtrU+QLv61+mQoDOkbobOvbgSPlU3eH4CWED4bQ5C3oIlpGFLSjcYnslHwnCzFUsh1d/YH4Jpt6lX5kPzZFSRQVjqI8ucrLVhsQvtERKOzjQh3i611WbZB8Rn7dUS2jIWk5egUQPJ+bhDbGd9DqZ1th3Q==

	```
	
2. 客户端配置文件

	+ /etc/ssh_config 全局配置
	+ .ssh/config 本地配置

	本地配置优先级高于全局配置 
	
	**配置项**
	
	+ Host  主机配置（也是分段标志,接下了的配置就是和这个主机配置相关的，直到碰到另一个Host)

		`Host <string>`  
		`Host www.x.cn` domain   
		`Host 123.123.123.123`ip  
		`Host 123.123.*` 通配符  
		`Host dev1` 别名   
		`HostName www.x.cn`  
		`port 27155`  
		`User git`  
		
	+ IdentityFile 用户身份标识

		`IdentifyFile <private key file>`
		
		command mode: `ssh -i ~/.ssh/id_rsa 10.86.211.11`用私钥登录

		
	+ ProxyCommand 

		看不太懂，link先记下
		[SSH ProxyCommand 实践 ](https://www.cnblogs.com/shanpow/p/4264867.html)

	配置详情参阅:《SSH权威指南》客户端的配置(page 280)
	
	```
	# generated by qzz-copy-id
	Host *
	    User tao.zhu

	Host *
	User tao.zhu
	ServerAliveInterval 30
	ControlMaster auto
	ControlPath ~/.ssh/persist/master-%r@%h:%p
	ControlPersist yes
	```

3. authorized_keys 文件

	服务器保存客户机的公钥。
	把自己的公钥放在服务器上的.ssh/authorized_keys文件内后，可直接ssh
	
4. /etc/ssh/moduli
5. /etc/ssh/ssh_config  存放作为客户端的一些ssh配置
6. etc/ssh/sshd_config 存放作为服务器端的一些ssh配置  


#### 重新生成公钥后要干的事
git SSH keys 重新设置
ssh 免登录主机重新设置

 




**注意 注意 注意**  
**设置免密登录时，必须要保证被登录服务器用户的.ssh文件夹及下的authorized_keys文件除本用户的其它用户无写权限，否则免密登录不生效**  
**还要密切注意服务器上/etc/ssh/sshd_config的下列字段必须打开**
	
	```
	RSAAuthentication yes
	PubkeyAuthentication yes
	AuthorizedKeysFile	.ssh/authorized_keys
	
	```
	
> [引用网文](https://www.cnblogs.com/snowbook/p/5671406.html)  
> 后来，我详细查了一下，如果authorized_keys文件、$HOME/.ssh目录 或 $HOME目录让本用户之外的用户有写权限，那么sshd都会拒绝使用 ~/.ssh/authorized_keys 文件中的key来进行认证的。


